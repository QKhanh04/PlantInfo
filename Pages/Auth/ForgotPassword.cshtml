@page
@model ForgotPasswordModel

@section Styles {
    <link rel="stylesheet" href="~/css/auth.css">
}
<div class="background">
    <div class="auth-container">
        <h2 class="auth-title">Forgot Password</h2>

        @if (Model.Step == 1)
        {
            <form method="post" asp-page-handler="SendOtp" class="form-wrapper active">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <div class="input-icon">
                        <i class="bi bi-envelope"></i>
                        <input asp-for="SendOtpVM.Email" class="form-input" />
                    </div>
                    <span asp-validation-for="SendOtpVM.Email" class="error-message"></span>
                </div>
                <button type="submit" class="submit-button">Send OTP</button>
            </form>
        }

        @if (Model.Step == 2)
        {
            <form method="post" asp-page-handler="VerifyOtp" class="form-wrapper active">
                <div class="form-group">
                    <label class="form-label">Enter OTP</label>
                    <div class="input-icon">
                        <i class="bi bi-key"></i>
                        <input asp-for="VerifyOtpVM.Otp" maxlength="6" pattern="\d{6}" inputmode="numeric"
                            autocomplete="one-time-code" class="form-input" />
                    </div>
                    <span asp-validation-for="VerifyOtpVM.Otp" class="error-message"></span>
                </div>
                <button type="submit" class="submit-button">Verify OTP</button>
            </form>
        }

        @if (Model.Step == 3)
        {
            <form method="post" asp-page-handler="ChangePassword" class="form-wrapper active">
                <div class="form-group">
                    <label class="form-label">New Password</label>
                    <div class="input-icon">
                        <i class="bi bi-lock"></i>
                        <input asp-for="ChangePasswordVM.NewPassword" type="password" class="form-input" />
                        <button type="button" class="password-toggle"><i class="bi bi-eye" tabindex="-1"></i></button>
                    </div>
                    <span asp-validation-for="ChangePasswordVM.NewPassword" class="error-message"></span>
                </div>

                <div class="form-group">
                    <label class="form-label">Confirm Password</label>
                    <div class="input-icon">
                        <i class="bi bi-lock"></i>
                        <input asp-for="ChangePasswordVM.ConfirmPassword" type="password" class="form-input" />
                        <button type="button" class="password-toggle" tabindex="-1"><i class="bi bi-eye"></i></button>
                    </div>
                    <span asp-validation-for="ChangePasswordVM.ConfirmPassword" class="error-message"></span>
                </div>

                <button type="submit" class="submit-button">Change Password</button>
            </form>
        }

        @* <div asp-validation-summary="All" class="error-message"></div> *@
    </div>
</div>

@section Scripts {
    <script>
        document.querySelectorAll('.password-toggle').forEach(btn => {
            btn.addEventListener('click', () => {
                const input = btn.previousElementSibling;
                input.type = input.type === 'password' ? 'text' : 'password';
                btn.innerHTML = input.type === 'password' ? '<i class="bi bi-eye"></i>' : '<i class="bi bi-eye-slash"></i>';
            });
        });
    </script>

    <partial name="_ValidationScriptsPartial" />
}