@page
@model AuthenticationModel
@{
    ViewData["Title"] = "Authentication";
}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>
    <link rel="stylesheet" href="~/css/auth.css" />
</head>

<body>
    <div class="background">
        <div class="auth-container">
            <h1 class="auth-title">T√†i kho·∫£n ng∆∞·ªùi d√πng</h1>
            <p class="auth-subtitle">
                ƒêƒÉng nh·∫≠p ho·∫∑c t·∫°o t√†i kho·∫£n ƒë·ªÉ s·ª≠ d·ª•ng c√°c t√≠nh nƒÉng c√° nh√¢n h√≥a
            </p>

            <!-- Tab Buttons -->
            <div class="tab-buttons">
                <div class="tab-indicator @(Model.ActiveTab == "register" ? "register" : "")"></div>
                <button type="button" class="tab-button @(Model.ActiveTab == "login" ? "active" : "")"
                    onclick="switchToLogin()">ƒêƒÉng nh·∫≠p</button>
                <button type="button" class="tab-button @(Model.ActiveTab == "register" ? "active" : "")"
                    onclick="switchToRegister()">ƒêƒÉng k√Ω</button>
            </div>

            <!-- Forms Container -->
            <div class="forms-container" id="formsContainer">

                <!-- Login Form -->
                <div class="form-wrapper login @(Model.ActiveTab != "login" ? "inactive" : "active")" id="loginForm">
                    <form method="post" asp-page-handler="Login" id="loginFormElement">
                        <input type="hidden" name="sessionId" id="sessionIdInput" />

                        <input type="hidden" name="returnUrl"
                            value="@PageContext.HttpContext.Request.Query["returnUrl"]" />
                        <!-- Username/Email -->
                        <div class="form-group">
                            <label class="form-label">Email ho·∫∑c Username</label>
                            <div class="input-icon">
                                <i class="bi bi-envelope"></i>
                                <input asp-for="LoginVM.UserNameOrEmail" class="form-input"
                                    placeholder="Nh·∫≠p email ho·∫∑c username" />
                            </div>
                            <span asp-validation-for="LoginVM.UserNameOrEmail" class="text-danger error-message"></span>
                        </div>

                        <!-- Password -->
                        <div class="form-group">
                            <label class="form-label">M·∫≠t kh·∫©u</label>
                            <div class="input-icon">
                                <i class="bi bi-lock"></i>
                                <input asp-for="LoginVM.Password" class="form-input" type="password" id="loginPassword"
                                    placeholder="........" />
                                <button type="button" class="password-toggle" tabindex="-1"
                                    onclick="togglePassword('loginPassword', this)">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>
                            <span asp-validation-for="LoginVM.Password" class="text-danger error-message"></span>
                        </div>
                        <div class="forgot-password-wrapper text-end">
                            <a class="forgot-password-btn" asp-page="/Auth/ForgotPassword" tabindex="-1">Qu√™n m·∫≠t
                                kh·∫©u</a>
                        </div>
                        <button type="submit" class="submit-button">ƒêƒÉng nh·∫≠p</button>
                    </form>
                </div>

                <!-- Register Form -->
                <div class="form-wrapper register @(Model.ActiveTab == "register" ? "active" : "inactive")"
                    id="registerForm">
                    <form method="post" asp-page-handler="Register">
                        <!-- Username -->
                        <div class="form-group">
                            <label class="form-label">Username</label>
                            <div class="input-icon">
                                <i class="bi bi-person"></i>
                                <input asp-for="RegisterVM.Username" class="form-input" placeholder="T√™n ƒëƒÉng nh·∫≠p" />
                            </div>
                            <span asp-validation-for="RegisterVM.Username" class="text-danger error-message"></span>
                        </div>

                        <!-- Email -->
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <div class="input-icon">
                                <i class="bi bi-envelope"></i>
                                <input asp-for="RegisterVM.Email" class="form-input" placeholder="your@email.com" />
                            </div>
                            <span asp-validation-for="RegisterVM.Email" class="text-danger error-message"></span>
                        </div>

                        <!-- Password -->
                        <div class="form-group">
                            <label class="form-label">M·∫≠t kh·∫©u</label>
                            <div class="input-icon">
                                <i class="bi bi-lock"></i>
                                <input asp-for="RegisterVM.Password" class="form-input" type="password"
                                    id="registerPassword" placeholder="........" />
                                <button type="button" class="password-toggle" tabindex="-1"
                                    onclick="togglePassword('registerPassword', this)">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>
                            <span asp-validation-for="RegisterVM.Password" class="text-danger error-message"></span>
                        </div>

                        <!-- Confirm Password -->
                        <div class="form-group">
                            <label class="form-label">X√°c nh·∫≠n m·∫≠t kh·∫©u</label>
                            <div class="input-icon">
                                <i class="bi bi-lock"></i>
                                <input asp-for="RegisterVM.ConfirmPassword" class="form-input" type="password"
                                    id="confirmPassword" placeholder="........" />
                                <button type="button" class="password-toggle" tabindex="-1"
                                    onclick="togglePassword('confirmPassword', this)">
                                    <i class="bi bi-eye-slash"></i>
                                </button>
                            </div>
                            <span asp-validation-for="RegisterVM.ConfirmPassword"
                                class="text-danger error-message"></span>
                        </div>
                        @* <div> @TempData["SuccessMessage"]</div> *@

                        <button type="submit" class="submit-button">ƒêƒÉng k√Ω</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    @section Scripts {
        <script src="~/js/auth.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const input = document.getElementById("sessionIdInput");
                const currentSession = localStorage.getItem("chat_session_id");

                if (input && currentSession) {
                    input.value = currentSession;
                    console.log("üì§ G·ª≠i sessionId khi ƒëƒÉng nh·∫≠p:", currentSession);
                }

                const loginForm = document.getElementById("loginFormElement");
                if (loginForm) {
                    loginForm.addEventListener("submit", () => {
                        sessionStorage.setItem("toast_login_success", "true");
                    });
                }
            });
        </script>
        <partial name="_ValidationScriptsPartial" />
    }

</body>

</html>